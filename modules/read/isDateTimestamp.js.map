{"version":3,"file":"isDateTimestamp.js","names":["isDateTimestamp","value","styleId","styles","options","style","Error","BUILT_IN_DATE_NUMBER_FORMAT_IDS","indexOf","parseInt","numberFormat","id","dateFormat","template","smartDateParser","isDateTemplate","DATE_FORMAT_WEIRD_PREFIX","DATE_FORMAT_WEIRD_POSTFIX","toLowerCase","replace","tokens","split","token","DATE_TEMPLATE_TOKENS"],"sources":["../../source/read/isDateTimestamp.js"],"sourcesContent":["// XLSX does have \"d\" type for dates, but it's not commonly used.\n// Instead, it prefers using \"n\" type for storing dates as timestamps.\n//\n// Whether a numeric value is a number or a date timestamp, it sometimes could be\n// detected by looking at the value \"format\" and seeing if it's a date-specific one.\n// https://github.com/catamphetamine/read-excel-file/issues/3#issuecomment-395770777\n//\n// The list of generic numeric value \"formats\":\n// https://xlsxwriter.readthedocs.io/format.html#format-set-num-format\n//\nexport default function isDateTimestamp(value, styleId, styles, options) {\n  if (styleId) {\n    const style = styles[styleId]\n    if (!style) {\n      throw new Error(`Cell style not found: ${styleId}`)\n    }\n    if (\n      // Whether it's a \"number format\" that's conventionally used for storing date timestamps.\n      BUILT_IN_DATE_NUMBER_FORMAT_IDS.indexOf(parseInt(style.numberFormat.id)) >= 0 ||\n      // Whether it's a \"number format\" that uses a \"formatting template\"\n      // that the developer is certain is a date formatting template.\n      (options.dateFormat && style.numberFormat.template === options.dateFormat) ||\n      // Whether the \"smart formatting template\" feature is not disabled\n      // and it has detected that it's a date formatting template by looking at it.\n      (options.smartDateParser !== false && style.numberFormat.template && isDateTemplate(style.numberFormat.template))\n     ) {\n      return true\n    }\n  }\n}\n\n// https://hexdocs.pm/xlsxir/number_styles.html\nconst BUILT_IN_DATE_NUMBER_FORMAT_IDS = [14,15,16,17,18,19,20,21,22,27,30,36,45,46,47,50,57]\n\n// On some date formats, there's an \"[$-414]\" prefix.\n// I don't have any idea what that is.\n//\n// https://stackoverflow.com/questions/4730152/what-indicates-an-office-open-xml-cell-contains-a-date-time-value\n//\n// Examples:\n//\n// * 27 (built-in format) \"[$-404]e/m/d\"\n// * 164 (custom format) \"[$-414]mmmm\\ yyyy;@\"\n//\nconst DATE_FORMAT_WEIRD_PREFIX = /^\\[\\$-414\\]/\n\n// On some date formats, there's an \";@\" postfix.\n// I don't have any idea what that is.\n// Examples:\n//\n// * 164 (custom format) \"m/d/yyyy;@\"\n// * 164 (custom format) \"[$-414]mmmm\\ yyyy;@\"\n//\nconst DATE_FORMAT_WEIRD_POSTFIX = /;@$/\n\nfunction isDateTemplate(template) {\n  // Date format tokens could be in upper case or in lower case.\n  // There seems to be no single standard.\n  // So lowercase the template first.\n  template = template.toLowerCase()\n\n  // On some date formats, there's an \"[$-414]\" prefix.\n  // I don't have any idea what that is. Trim it.\n  template = template.replace(DATE_FORMAT_WEIRD_PREFIX, '')\n\n  // On some date formats, there's an \";@\" postfix.\n  // I don't have any idea what that is. Trim it.\n  template = template.replace(DATE_FORMAT_WEIRD_POSTFIX, '')\n\n  const tokens = template.split(/\\W+/)\n  for (const token of tokens) {\n    if (DATE_TEMPLATE_TOKENS.indexOf(token) < 0) {\n      return false\n    }\n  }\n  return true\n}\n\n// These tokens could be in upper case or in lower case.\n// There seems to be no single standard, so using lower case.\nconst DATE_TEMPLATE_TOKENS = [\n  // Seconds (min two digits). Example: \"05\".\n  'ss',\n  // Minutes (min two digits). Example: \"05\". Could also be \"Months\". Weird.\n  'mm',\n  // Hours. Example: \"1\".\n  'h',\n  // Hours (min two digits). Example: \"01\".\n  'hh',\n  // \"AM\" part of \"AM/PM\". Lowercased just in case.\n  'am',\n  // \"PM\" part of \"AM/PM\". Lowercased just in case.\n  'pm',\n  // Day. Example: \"1\"\n  'd',\n  // Day (min two digits). Example: \"01\"\n  'dd',\n  // Month (numeric). Example: \"1\".\n  'm',\n  // Month (numeric, min two digits). Example: \"01\". Could also be \"Minutes\". Weird.\n  'mm',\n  // Month (shortened month name). Example: \"Jan\".\n  'mmm',\n  // Month (full month name). Example: \"January\".\n  'mmmm',\n  // Two-digit year. Example: \"20\".\n  'yy',\n  // Full year. Example: \"2020\".\n  'yyyy',\n\n  // I don't have any idea what \"e\" means.\n  // It's used in \"built-in\" XLSX formats:\n  // * 27 '[$-404]e/m/d';\n  // * 36 '[$-404]e/m/d';\n  // * 50 '[$-404]e/m/d';\n  // * 57 '[$-404]e/m/d';\n  'e'\n];"],"mappings":";;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,SAASA,eAAe,CAACC,KAAK,EAAEC,OAAO,EAAEC,MAAM,EAAEC,OAAO,EAAE;EACvE,IAAIF,OAAO,EAAE;IACX,IAAMG,KAAK,GAAGF,MAAM,CAACD,OAAO,CAAC;IAC7B,IAAI,CAACG,KAAK,EAAE;MACV,MAAM,IAAIC,KAAK,iCAA0BJ,OAAO,EAAG;IACrD;IACA;IACE;IACAK,+BAA+B,CAACC,OAAO,CAACC,QAAQ,CAACJ,KAAK,CAACK,YAAY,CAACC,EAAE,CAAC,CAAC,IAAI,CAAC;IAC7E;IACA;IACCP,OAAO,CAACQ,UAAU,IAAIP,KAAK,CAACK,YAAY,CAACG,QAAQ,KAAKT,OAAO,CAACQ,UAAW;IAC1E;IACA;IACCR,OAAO,CAACU,eAAe,KAAK,KAAK,IAAIT,KAAK,CAACK,YAAY,CAACG,QAAQ,IAAIE,cAAc,CAACV,KAAK,CAACK,YAAY,CAACG,QAAQ,CAAE,EAChH;MACD,OAAO,IAAI;IACb;EACF;AACF;;AAEA;AACA,IAAMN,+BAA+B,GAAG,CAAC,EAAE,EAAC,EAAE,EAAC,EAAE,EAAC,EAAE,EAAC,EAAE,EAAC,EAAE,EAAC,EAAE,EAAC,EAAE,EAAC,EAAE,EAAC,EAAE,EAAC,EAAE,EAAC,EAAE,EAAC,EAAE,EAAC,EAAE,EAAC,EAAE,EAAC,EAAE,EAAC,EAAE,CAAC;;AAE5F;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAMS,wBAAwB,GAAG,aAAa;;AAE9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAMC,yBAAyB,GAAG,KAAK;AAEvC,SAASF,cAAc,CAACF,QAAQ,EAAE;EAChC;EACA;EACA;EACAA,QAAQ,GAAGA,QAAQ,CAACK,WAAW,EAAE;;EAEjC;EACA;EACAL,QAAQ,GAAGA,QAAQ,CAACM,OAAO,CAACH,wBAAwB,EAAE,EAAE,CAAC;;EAEzD;EACA;EACAH,QAAQ,GAAGA,QAAQ,CAACM,OAAO,CAACF,yBAAyB,EAAE,EAAE,CAAC;EAE1D,IAAMG,MAAM,GAAGP,QAAQ,CAACQ,KAAK,CAAC,KAAK,CAAC;EACpC,qDAAoBD,MAAM,wCAAE;IAAA,IAAjBE,KAAK;IACd,IAAIC,oBAAoB,CAACf,OAAO,CAACc,KAAK,CAAC,GAAG,CAAC,EAAE;MAC3C,OAAO,KAAK;IACd;EACF;EACA,OAAO,IAAI;AACb;;AAEA;AACA;AACA,IAAMC,oBAAoB,GAAG;AAC3B;AACA,IAAI;AACJ;AACA,IAAI;AACJ;AACA,GAAG;AACH;AACA,IAAI;AACJ;AACA,IAAI;AACJ;AACA,IAAI;AACJ;AACA,GAAG;AACH;AACA,IAAI;AACJ;AACA,GAAG;AACH;AACA,IAAI;AACJ;AACA,KAAK;AACL;AACA,MAAM;AACN;AACA,IAAI;AACJ;AACA,MAAM;AAEN;AACA;AACA;AACA;AACA;AACA;AACA,GAAG,CACJ"}